{"ast":null,"code":"var _jsxFileName = \"/home/joserevete/Documentos/minisplit/pagina/minisplit-master/src/lib/authContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nimport { useQuery } from '@tanstack/react-query';\nimport React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useNavigate } from 'react-router-dom';\nimport { createSelector } from 'reselect';\nimport { getLoggedinUser } from '../helpers/api_helper';\nimport { getAuthMe, getTicketConfiguration, postFakeRefreshToken, updateContact } from '../helpers/backend_helper';\nimport { loginSuccess } from '../slices/auth/login/reducer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const useUpdateUser = () => {\n  _s();\n  const {\n    user\n  } = useStoredUser();\n  const loggedUser = getLoggedinUser();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const updateUser = async () => {\n    try {\n      var _userData$data;\n      const userData = await getAuthMe();\n      dispatch(loginSuccess({\n        ...user,\n        ...userData.data,\n        has_forgot_password: Boolean(userData === null || userData === void 0 ? void 0 : (_userData$data = userData.data) === null || _userData$data === void 0 ? void 0 : _userData$data.has_forgot_password)\n      }));\n    } catch (error) {\n      var _loggedUser$data;\n      const refreshToken = loggedUser === null || loggedUser === void 0 ? void 0 : (_loggedUser$data = loggedUser.data) === null || _loggedUser$data === void 0 ? void 0 : _loggedUser$data.refresh_token;\n      if (error.status === 401 && refreshToken) {\n        try {\n          var _tokenRes$data, _userData$data2;\n          const tokenRes = await postFakeRefreshToken({\n            refresh_token: refreshToken\n          });\n          const userData = await getAuthMe(tokenRes === null || tokenRes === void 0 ? void 0 : (_tokenRes$data = tokenRes.data) === null || _tokenRes$data === void 0 ? void 0 : _tokenRes$data.access_token);\n          dispatch(loginSuccess({\n            ...userData.data,\n            ...tokenRes,\n            has_forgot_password: Boolean(userData === null || userData === void 0 ? void 0 : (_userData$data2 = userData.data) === null || _userData$data2 === void 0 ? void 0 : _userData$data2.has_forgot_password)\n          }));\n          localStorage.setItem('authUser', JSON.stringify(tokenRes));\n          navigate(0);\n        } catch (error) {\n          if (error.status !== 200) {\n            localStorage.removeItem('authUser');\n            navigate(0);\n          }\n        }\n      }\n    }\n  };\n  return {\n    updateUser\n  };\n};\n_s(useUpdateUser, \"tHMsohB7rSTZMjlGyVf40I+2Wr0=\", false, function () {\n  return [useStoredUser, useNavigate, useDispatch];\n});\nconst AuthProvider = ({\n  children\n}) => {\n  /*   const { updateUser } = useUpdateUser()\n    const { user } = useStoredUser()\n    const loggedUser = getLoggedinUser()\n    const navigate = useNavigate()\n  \n    useEffect(() => {\n      if (!loggedUser?.data?.access_token || user?.id) return\n      void updateUser()\n    }, [])\n  \n    useEffect(() => {\n      if (!user?.has_forgot_password) return\n      navigate('/user-profile')\n    }, [user?.has_forgot_password]) */\n\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 10\n  }, this);\n};\n_c = AuthProvider;\nconst useStoredUser = () => {\n  _s2();\n  var _ticketConfigurationQ, _user$edges, _user$edges$company, _user$edges2, _user$edges2$company, _user$edges3, _user$edges3$role, _user$data;\n  const ticketConfigurationQuery = useQuery({\n    queryKey: ['ticket-configuration'],\n    queryFn: () => getTicketConfiguration()\n  });\n  const ticketConfiguration = ticketConfigurationQuery === null || ticketConfigurationQuery === void 0 ? void 0 : (_ticketConfigurationQ = ticketConfigurationQuery.data) === null || _ticketConfigurationQ === void 0 ? void 0 : _ticketConfigurationQ.data;\n  const userDataFromRedux = createSelector(state => state.Login, state => state.user);\n  const loadingLoginFromRedux = createSelector(state => state.Login, state => state.loading);\n  const user = useSelector(userDataFromRedux);\n  const loading = useSelector(loadingLoginFromRedux);\n  const isProductCompanyDetailSlug = (user === null || user === void 0 ? void 0 : (_user$edges = user.edges) === null || _user$edges === void 0 ? void 0 : (_user$edges$company = _user$edges.company) === null || _user$edges$company === void 0 ? void 0 : _user$edges$company.detail_slug) === 'producto';\n  const isServiceCompanyDetailSlug = (user === null || user === void 0 ? void 0 : (_user$edges2 = user.edges) === null || _user$edges2 === void 0 ? void 0 : (_user$edges2$company = _user$edges2.company) === null || _user$edges2$company === void 0 ? void 0 : _user$edges2$company.detail_slug) === 'servicio';\n  const isAsesor = (user === null || user === void 0 ? void 0 : (_user$edges3 = user.edges) === null || _user$edges3 === void 0 ? void 0 : (_user$edges3$role = _user$edges3.role) === null || _user$edges3$role === void 0 ? void 0 : _user$edges3$role.slug) === 'asesor';\n  return {\n    user,\n    isLogged: Boolean(user === null || user === void 0 ? void 0 : user.id),\n    token: user === null || user === void 0 ? void 0 : (_user$data = user.data) === null || _user$data === void 0 ? void 0 : _user$data.access_token,\n    loading,\n    isAsesor,\n    isProductCompanyDetailSlug,\n    isServiceCompanyDetailSlug,\n    ticketConfiguration\n  };\n};\n_s2(useStoredUser, \"dVzrpJ5vckh0Yp3zlqMhpWZSd4U=\", false, function () {\n  return [useQuery, useSelector, useSelector];\n});\nexport const useToggleUserStatus = () => {\n  _s3();\n  const {\n    user\n  } = useStoredUser();\n  const isActive = (user === null || user === void 0 ? void 0 : user.status) === 'Activo';\n  const {\n    updateUser\n  } = useUpdateUser();\n  const handleToggle = async () => {\n    try {\n      await updateContact({\n        id: user === null || user === void 0 ? void 0 : user.id,\n        status: isActive ? 'Inactivo' : 'Activo'\n      });\n      void updateUser();\n    } catch (error) {\n      console.error('Error updating user status:', error);\n    }\n  };\n  return {\n    handleToggle,\n    isActive\n  };\n};\n_s3(useToggleUserStatus, \"y914+9aEZ9X388zDyvgP2qAcs2w=\", false, function () {\n  return [useStoredUser, useUpdateUser];\n});\nexport { AuthProvider, useStoredUser };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["useQuery","React","useEffect","useDispatch","useSelector","useNavigate","createSelector","getLoggedinUser","getAuthMe","getTicketConfiguration","postFakeRefreshToken","updateContact","loginSuccess","jsxDEV","_jsxDEV","useUpdateUser","_s","user","useStoredUser","loggedUser","navigate","dispatch","updateUser","_userData$data","userData","data","has_forgot_password","Boolean","error","_loggedUser$data","refreshToken","refresh_token","status","_tokenRes$data","_userData$data2","tokenRes","access_token","localStorage","setItem","JSON","stringify","removeItem","AuthProvider","children","Fragment","fileName","_jsxFileName","lineNumber","columnNumber","_c","_s2","_ticketConfigurationQ","_user$edges","_user$edges$company","_user$edges2","_user$edges2$company","_user$edges3","_user$edges3$role","_user$data","ticketConfigurationQuery","queryKey","queryFn","ticketConfiguration","userDataFromRedux","state","Login","loadingLoginFromRedux","loading","isProductCompanyDetailSlug","edges","company","detail_slug","isServiceCompanyDetailSlug","isAsesor","role","slug","isLogged","id","token","useToggleUserStatus","_s3","isActive","handleToggle","console","$RefreshReg$"],"sources":["/home/joserevete/Documentos/minisplit/pagina/minisplit-master/src/lib/authContext.js"],"sourcesContent":["import { useQuery } from '@tanstack/react-query'\nimport React, { useEffect } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { useNavigate } from 'react-router-dom'\nimport { createSelector } from 'reselect'\nimport { getLoggedinUser } from '../helpers/api_helper'\nimport {\n  getAuthMe,\n  getTicketConfiguration,\n  postFakeRefreshToken,\n  updateContact,\n} from '../helpers/backend_helper'\nimport { loginSuccess } from '../slices/auth/login/reducer'\n\nexport const useUpdateUser = () => {\n  const { user } = useStoredUser()\n  const loggedUser = getLoggedinUser()\n  const navigate = useNavigate()\n  const dispatch = useDispatch()\n\n  const updateUser = async () => {\n    try {\n      const userData = await getAuthMe()\n      dispatch(\n        loginSuccess({\n          ...user,\n          ...userData.data,\n          has_forgot_password: Boolean(userData?.data?.has_forgot_password),\n        }),\n      )\n    } catch (error) {\n      const refreshToken = loggedUser?.data?.refresh_token\n      if (error.status === 401 && refreshToken) {\n        try {\n          const tokenRes = await postFakeRefreshToken({\n            refresh_token: refreshToken,\n          })\n          const userData = await getAuthMe(tokenRes?.data?.access_token)\n          dispatch(\n            loginSuccess({\n              ...userData.data,\n              ...tokenRes,\n              has_forgot_password: Boolean(userData?.data?.has_forgot_password),\n            }),\n          )\n          localStorage.setItem('authUser', JSON.stringify(tokenRes))\n          navigate(0)\n        } catch (error) {\n          if (error.status !== 200) {\n            localStorage.removeItem('authUser')\n            navigate(0)\n          }\n        }\n      }\n    }\n  }\n\n  return { updateUser }\n}\n\nconst AuthProvider = ({ children }) => {\n/*   const { updateUser } = useUpdateUser()\n  const { user } = useStoredUser()\n  const loggedUser = getLoggedinUser()\n  const navigate = useNavigate()\n\n  useEffect(() => {\n    if (!loggedUser?.data?.access_token || user?.id) return\n    void updateUser()\n  }, [])\n\n  useEffect(() => {\n    if (!user?.has_forgot_password) return\n    navigate('/user-profile')\n  }, [user?.has_forgot_password]) */\n\n  return <React.Fragment>{children}</React.Fragment>\n}\n\nconst useStoredUser = () => {\n  const ticketConfigurationQuery = useQuery({\n    queryKey: ['ticket-configuration'],\n    queryFn: () => getTicketConfiguration(),\n  })\n\n  const ticketConfiguration = ticketConfigurationQuery?.data?.data\n\n  const userDataFromRedux = createSelector(\n    state => state.Login,\n    state => state.user,\n  )\n\n  const loadingLoginFromRedux = createSelector(\n    state => state.Login,\n    state => state.loading,\n  )\n\n  const user = useSelector(userDataFromRedux)\n  const loading = useSelector(loadingLoginFromRedux)\n\n  const isProductCompanyDetailSlug = user?.edges?.company?.detail_slug === 'producto'\n  const isServiceCompanyDetailSlug = user?.edges?.company?.detail_slug === 'servicio'\n  const isAsesor = user?.edges?.role?.slug === 'asesor'\n\n  return {\n    user,\n    isLogged: Boolean(user?.id),\n    token: user?.data?.access_token,\n    loading,\n    isAsesor,\n    isProductCompanyDetailSlug,\n    isServiceCompanyDetailSlug,\n    ticketConfiguration,\n  }\n}\n\nexport const useToggleUserStatus = () => {\n  const { user } = useStoredUser()\n  const isActive = user?.status === 'Activo'\n  const { updateUser } = useUpdateUser()\n\n  const handleToggle = async () => {\n    try {\n      await updateContact({\n        id: user?.id,\n        status: isActive ? 'Inactivo' : 'Activo',\n      })\n      void updateUser()\n    } catch (error) {\n      console.error('Error updating user status:', error)\n    }\n  }\n\n  return { handleToggle, isActive }\n}\n\nexport { AuthProvider, useStoredUser }\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}